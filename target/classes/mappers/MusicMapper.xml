<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ncs.MusicMapper">

<!-- ******************************* -->
<select id="selectList" resultType="vo.MusicVO">
	 select * from music order by releasedate desc , sname
</select>

<select id="selectOne" resultType="vo.MusicVO"> <!-- 노래 재생목록을 위한 sql  -->
	  select snum, sname, stitle, singername, releasedate, genre, 
      replace(lyrics,'-','') lyrics, country, musicurl, 
      downloadfile, image, count from music where snum=#{snum}
</select>

<update id="musicCount"> <!-- count를 위한 sql -->
	UPDATE music set count=#{count} WHERE snum=#{snum}
</update>

<!-- 검색 및 페이징 부분 -->
<sql id="search1">
  <if test="keyword != null">
  	<bind name="keyVal" value="'%'+keyword+'%'"/>
  </if>	
   <choose>
  	<when test="searchType=='all'.toString()">   
  		and upper(sname) Like  '%' || upper(#{keyword}) || '%' 
  		or upper(singername) Like  '%' || upper(#{keyword}) || '%' 
  		or upper(stitle) Like  '%' || upper(#{keyword}) || '%' 
  		or lyrics Like  '%' || #{keyword} || '%' 
  		or  genre Like  '%' || #{keyword} || '%')
  	</when>
  	<otherwise>)</otherwise> 
  </choose>
</sql>


<sql id="search2">
  	<bind name="keyVal" value="'%'+keyword+'%'"/>
  <choose>
  	<when test="searchType=='all'.toString()">   
  		and upper(sname) Like upper(#{keyVal}))
  	</when>
  	<otherwise>)</otherwise> 
  </choose> 
</sql>

<sql id="search3">
  	<bind name="keyVal" value="'%'+keyword+'%'"/>
  <choose>
  	<when test="searchType=='all'.toString()">   
  		and upper(singername) Like upper(#{keyVal}))
  	</when>
  	<otherwise>)</otherwise> 
  </choose> 
</sql>

<sql id="search4">
  	<bind name="keyVal" value="'%'+keyword+'%'"/>
  <choose>
  	<when test="searchType=='all'.toString()">   
  		and upper(lyrics) Like upper(#{keyVal}))
  	</when>
  	<otherwise>)</otherwise> 
  </choose> 
</sql>



 <select id="searchAllList" resultType="vo.MusicVO">  <!-- searchMList에서 M은통합 , N 곡이름..가운데본뜸 -->
 <if test="searchType=='all'.toString()">
 <![CDATA[
 select snum,image,sname,singername,stitle,downloadfile,genre,rnum from
 (select m.* , ROW_NUMBER() OVER(order by snum desc) rnum from music m 
   where snum > 0 ]]>
  <include refid="search1"></include>
  where rnum between #{sno} and #{eno}
  
</if>
</select>

 <select id="searchSnameList" resultType="vo.MusicVO">
 <if test="searchType=='all'.toString()">
 <![CDATA[
 select snum,image,sname,singername,stitle,downloadfile,genre,rnum from
 (select m.* , ROW_NUMBER() OVER(order by snum desc) rnum from music m 
   where snum > 0 ]]>
  <include refid="search2"></include>
  where rnum between #{sno} and #{eno}
</if>
</select>


 <select id="searchSingerNameList" resultType="vo.MusicVO">
 <if test="searchType=='all'.toString()">
 <![CDATA[
 select snum,image,sname,singername,stitle,downloadfile,genre,rnum from
 (select m.* , ROW_NUMBER() OVER(order by snum desc) rnum from music m 
   where snum > 0 ]]>
  <include refid="search3"></include>
  where rnum between #{sno} and #{eno}
</if>
</select>

 <select id="searchLyricsList" resultType="vo.MusicVO">
 <if test="searchType=='all'.toString()">
 <![CDATA[
 select snum,image,sname,singername,stitle,downloadfile,genre,rnum from
 (select m.* , ROW_NUMBER() OVER(order by snum desc) rnum from music m 
   where snum > 0 ]]>
  <include refid="search4"></include>
  where rnum between #{sno} and #{eno}
</if>
</select>

 
<select id="searchRowCountAll" resultType="int">
<![CDATA[ 	
	select count(*) from music where ( snum > 0 ]]>
	<!-- 조건 id : search -->
	<include refid="search1"></include>   <!-- 여기때문에 500난 것도 있엇음. -->
</select>																<!-- 일단은 search1만됨 -->

<select id="searchRowCountSname" resultType="int">
<![CDATA[ 	
	select count(*) from music where ( snum > 0 ]]>
	<!-- 조건 id : search -->
	<include refid="search2"></include>  
</select>			

<select id="searchRowCountSingerName" resultType="int">
<![CDATA[ 	
	select count(*) from music where ( snum > 0 ]]>
	<!-- 조건 id : search -->
	<include refid="search3"></include>  
</select>	

<select id="searchRowCountLyrics" resultType="int">
<![CDATA[ 	
	select count(*) from music where ( snum > 0 ]]>
	<!-- 조건 id : search -->
	<include refid="search4"></include>  
</select>														



<!-- PageList -->
<select id="totalRowCountAll" resultType="int">
	 select count(*) from snum 
</select> 

<select id="totalRowCountSname" resultType="int">
	 select count(*) from snum 
</select> 


<select id="pageMList" resultType="vo.MusicVO"> 
  select snum,image,sname,singername,stitle,downloadfile,genre,rnum  
  from music where rnum between #{sno} and #{eno}  <!-- //원래 이문장만 있었음 -->
</select>


</mapper>  